# –°–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Camunda

## –û–ø–∏—Å–∞–Ω–∏–µ
`camunda_processes.py` - —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –≤ Camunda —á–µ—Ä–µ–∑ REST API.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- üìã **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö BPMN –º–æ–¥–µ–ª–µ–π
- üèÉ **–≠–∫–∑–µ–º–ø–ª—è—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** - –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚ö° **–í–Ω–µ—à–Ω–∏–µ –∑–∞–¥–∞—á–∏** - External Tasks –æ–∂–∏–¥–∞—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- üë§ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏** - Human Tasks –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ–±—â–∏–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
- üìÅ **–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
```bash
python camunda_processes.py
```

### –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
```bash
python camunda_processes.py --stats
```

### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ JSON:
```bash
python camunda_processes.py --export camunda_data.json
```

## –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `python camunda_processes.py` | –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é |
| `python camunda_processes.py --stats` | –¢–æ–ª—å–∫–æ –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `python camunda_processes.py --definitions` | –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |
| `python camunda_processes.py --instances` | –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã |
| `python camunda_processes.py --instances --all-instances` | –í—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã (–≤–∫–ª—é—á–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ) |
| `python camunda_processes.py --external-tasks` | –¢–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `python camunda_processes.py --user-tasks` | –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ |
| `python camunda_processes.py --export file.json` | –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ JSON |

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
```
üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Camunda: https://camunda.eg-holding.ru
üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –í–∫–ª—é—á–µ–Ω–∞

================================================================================
üèóÔ∏è  –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –î–í–ò–ñ–ö–ï CAMUNDA
================================================================================
Version: 7.21.0
Date: 2024-11-15

================================================================================
üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
================================================================================
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: 5
–ê–∫—Ç–∏–≤–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤: 12
–í–Ω–µ—à–Ω–∏—Ö –∑–∞–¥–∞—á: 8
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–¥–∞—á: 3

–í–Ω–µ—à–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ —Ç–æ–ø–∏–∫–∞–º:
  bitrix_create_task: 3
  send_email: 2
  telegram_notify: 2
  yandex_disk: 1

–ê–∫—Ç–∏–≤–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º:
  project_management: 7
  document_approval: 3
  user_registration: 2
```

### –í–Ω–µ—à–Ω–∏–µ –∑–∞–¥–∞—á–∏:
```
================================================================================
‚ö° –í–ù–ï–®–ù–ò–ï –ó–ê–î–ê–ß–ò (8)
================================================================================

1. Task ID: abc123-def456-ghi789
   Topic Name: bitrix_create_task
   Worker ID: universal-worker
   Process Instance ID: pi-123456
   Process Definition Key: project_management
   Activity ID: CreateBitrixTask
   Retries: 3
   Priority: 50
   Lock Expiration: 2025-12-15 10:30:00
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞
–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `config.py`:
- URL Camunda: `camunda_config.base_url`
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: `camunda_config.auth_username` / `camunda_config.auth_password`

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ https://camunda.eg-holding.ru/engine-rest/version: Connection refused
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Camunda —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –≤ `config.py`

### –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ https://camunda.eg-holding.ru/engine-rest/version: 401 Unauthorized
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ `config.py` –∏–ª–∏ —Ñ–∞–π–ª–µ `.env`

### SSL –æ—à–∏–±–∫–∏:
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ cron:
```bash
# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
*/5 * * * * cd /opt/camunda-worker && ./venv/bin/python camunda_processes.py --stats >> /var/log/camunda-monitoring.log
```

### –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
python camunda_processes.py --export "camunda_$(date +%Y%m%d).json"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ:
```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–¥–∞—á
EXTERNAL_TASKS=$(python camunda_processes.py --external-tasks | grep -c "Task ID")
if [ "$EXTERNAL_TASKS" -gt 10 ]; then
    echo "–í–Ω–∏–º–∞–Ω–∏–µ: $EXTERNAL_TASKS –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏" | mail -s "Camunda Alert" admin@company.com
fi
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.7+
- requests >= 2.25.0
- –î–æ—Å—Ç—É–ø –∫ Camunda REST API

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º:
–ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º, –∏–∑–º–µ–Ω–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–µ—Ç–æ–¥–µ `get_process_instances()`.

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
–°–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Ç–∞–∫–æ–π –∫–∞–∫:
- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–Ω–∞–ª–∏–∑ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö

---

**üí° –°–æ–≤–µ—Ç:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--external-tasks --stats`. 